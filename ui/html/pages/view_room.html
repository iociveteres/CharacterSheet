{{define "title"}}{{.Room.Name}}{{end}}
{{define "main"}}
<div class='room' id="room" data-room-id="{{.Room.ID}}">
    <div id="character-sheet-container">
        {{if .CharacterSheet}}
        {{template "character_sheet_fragment" .}}
        {{end}}
    </div>

    <div id="right-panel">
        <div class="tabs">
            <input class="radiotab" type="radio" id="show-chat" name="toggle" />
            <label class="tablabel" for="show-chat">Chat</label>
            <div id="chat" class="panel chat">
                <div class="scroll-container"></div>
            </div>

            <input class="radiotab" type="radio" id="show-characters" name="toggle" />
            <label class="tablabel" for="show-characters">Characters</label>
            <div id="characters" class="panel characters">
                <div class="scroll-container">
                    <button id="new-character" class="button-wide" type="button">New character</button>
                    {{with .CurrentPlayerView}}
                    <div class='player' data-user-id="{{.User.ID}}">
                        <div class="player-name">{{.User.Name}}</div>
                        {{range .CharacterSheets}}
                        <div class="character-sheet-entry" data-sheet-id="{{.ID}}">
                            <div class="name"><a href="/sheet/view/{{.ID}}">{{.CharacterName}}</a></div>
                            <div class="meta created">Created {{humanDate .CreatedAt $.TimeZone}}</div>
                            <div class="meta updated">Modified {{humanDate .UpdatedAt $.TimeZone}}</div>
                            <div class="sheet-controls">
                                <button class="delete-sheet" type="button"></button>
                            </div>
                        </div>
                        {{end}}
                    </div>
                    {{end}}

                    {{range .PlayerViews}}
                    <div class='player' data-user-id="{{.User.ID}}">
                        <div class="player-name">{{.User.Name}}</div>
                        {{range .CharacterSheets}}
                        <div class="character-sheet-entry" data-sheet-id="{{.ID}}">
                            <div class="name"><a href="/sheet/view/{{.ID}}">{{.CharacterName}}</a></div>
                            <div class="meta created">Created {{humanDate .CreatedAt $.TimeZone}}</div>
                            <div class="meta updated">Modified {{humanDate .UpdatedAt $.TimeZone}}</div>
                            <div class="sheet-controls">
                                <button class="delete-sheet" type="button"></button>
                            </div>
                        </div>
                        {{end}}
                    </div>
                    {{end}}
                </div>
            </div>

            <input class="radiotab" type="radio" id="show-players" name="toggle" checked="checked" />
            <label class="tablabel" for="show-players">Players</label>
            <div id="players" class="panel players">
                <div class="scroll-container">
                    {{with .CurrentPlayerView}}
                    {{if or (eq .Role "gamemaster") (eq .Role "moderator")}}
                    <button id="open-invite-link-modal" class="button-wide" type="button">Create invite</button>
                    {{end}}
                    {{end}}

                    {{with .CurrentPlayerView}}
                    <div class='player' data-user-id="{{.User.ID}}">
                        <div class="player-name">{{.User.Name}}</div>
                        <div class="meta created">Joined at {{humanDate .JoinedAt $.TimeZone}}</div>
                    </div>
                    {{end}}

                    {{range .PlayerViews}}
                    <div class='player' data-user-id="{{.User.ID}}">
                        <div class="player-name">{{.User.Name}}</div>
                        <div class="meta created">Joined at {{humanDate .JoinedAt $.TimeZone}}</div>
                    </div>
                    {{end}}
                </div>
            </div>
        </div>
    </div>

    <div id="overlay" class="overlay" aria-hidden="true" tabindex="-1">
        {{if or (eq .CurrentPlayerView.Role "gamemaster") (eq .CurrentPlayerView.Role "moderator")}}
        <div id="invite-link-modal" class="modal layout-column" role="dialog" aria-modal="true"
            aria-labelledby="modalTitle">
            <div>
                <div>Active invite link</div>
                <div class="layout-row">
                    <input id="active-invite-link" type="text" readonly aria-label="Invite link"
                        value="{{.InviteLink}}" />
                    <button id="copy-invite-link" title="Copy invite link">Copy</button>
                </div>
            </div>

            <div id="new-link-options">
                Or create new one
                <div>
                    <div>
                        <label>Expires in:</label>
                        <select id="link-expires-in">
                            <option value="1">1 day</option>
                            <option value="7">7 days</option>
                            <option value="30">30 days</option>
                            <option value="0" selected="selected">Unlimited</option>
                        </select>
                    </div>

                    <div>
                        <label class="label" for="max-uses">Max uses (0 for unlimited):</label>
                        <input id="link-max-uses" name="max-uses" class="text" type="number" placeholder="0" min="0"
                            max="1000">
                    </div>
                </div>
            </div>

            <div class="actions">
                <button id="close-invite-link-modal" title="Close">Cancel</button>
                <button id="create-new-invite-link" title="Create new invite link">Create</button>
            </div>
        </div>
        {{end}}
    </div>
</div>

<script type="module" src="/static/js/room.js"></script>
<script type="module" src="/static/js/room_ui.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script type="module" src="/static/js/sheet/script.js"></script>
<script type="module" src="/static/js/sheet/dataIdTree.js"></script>
<script type="module" src="/static/js/sheet/network.js"></script>
{{end}}