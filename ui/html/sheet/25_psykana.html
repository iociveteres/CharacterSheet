{{define "psykana"}}
<div class="layout-column" data-id="psykana">
    <div id="pr-bar" class="layout-column centered-bar">
        <div class="layout-row">
            <label>Psykana type:
                <select data-id="psykana-type">
                    <option value="Bound" {{if eq .Psykana.PsykanaType "Bound" }}selected{{end}}>Bound</option>
                    <option value="Unbound" {{if eq .Psykana.PsykanaType "Unbound" }}selected{{end}}>Unbound</option>
                    <option value="Daemonic" {{if eq .Psykana.PsykanaType "Daemonic" }}selected{{end}}>Daemonic</option>
                </select>
            </label>
            <label>Max Push:
                <input data-id="max-push" type="number" class="short" value="{{ .Psykana.MaxPush }}">
            </label>
        </div>
        <div class="layout-row">
            <label>Base PR:
                <input data-id="base-pr" type="number" class="short" value="{{ .Psykana.BasePR }}">
            </label>
            <label>Sustained Powers:
                <input data-id="sustained-powers" type="number" class="short" value="{{ .Psykana.SustainedPowers }}">
            </label>
            <label>Effective PR:
                <input data-id="effective-pr" type="number" class="short uneditable textlike"
                    value="{{ .Psykana.EffectivePR }}">
            </label>
        </div>
    </div>

    <div class="tabs power-tabs" data-id="tabs.items">
        {{ $tabCols := layoutPsychicTabs "tabs" .Psykana.Tabs }}
        {{ range $colIndex, $col := $tabCols }}
        {{ range $rowIndex, $tabKey := $col }}
        {{ $tab := index $.Psykana.Tabs.Items $tabKey }}
        {{ $isFirst := and (eq $colIndex 0) (eq $rowIndex 0) }}

        <input class="radiotab" type="radio" id="{{ $tabKey }}" name="psykana-tabs" {{if $isFirst}}checked{{end}} />
        <label class="tablabel" for="{{ $tabKey }}" data-id="{{ $tabKey }}">
            <input data-id="name" value="{{ $tab.Name }}" />
            <div class="drag-handle"></div>
            <button class="delete-button"></button>
        </label>

        <div class="panel" data-id="{{ $tabKey }}">
            <div id="psychic-powers-{{ $tabKey }}" data-id="powers.items" class="item-grid">
                {{ $powerCols := layoutPsychicPowers "powers" $tab.Powers }}
                {{ range $powerColIndex, $powerCol := $powerCols }}
                <div class="layout-column" data-column="{{ $powerColIndex }}">
                    {{ range $powerRowIndex, $powerKey := $powerCol }}
                    {{ $p := index $tab.Powers.Items $powerKey }}
                    {{ $hasContent := or $p.Action $p.Effect }}
                    <div class="psychic-power item-with-description {{if $hasContent}}{{else}} collapsed{{end}}"
                        data-id="{{ $powerKey }}">
                        <div class="split-header dropdown-parent">
                            <div class="layout-row name">
                                <label class="rollable">Name:</label>
                                <input type="text" data-id="name" value="{{ $p.Name }}">
                            </div>
                            <button class="toggle-button"></button>
                            <div class="drag-handle"></div>
                            <button class="delete-button"></button>

                            {{ if $p.Roll }}
                            {{template "psychotest_roll" (dict "p" $p "key" $powerKey "tabKey" $tabKey)}}
                            {{ end }}
                        </div>

                        <div class="collapsible-content">
                            <div class="layout-row">
                                <div class="layout-row subtypes">
                                    <label>Subtypes:</label>
                                    <input data-id="subtypes" value="{{ $p.Subtypes }}">
                                </div>
                                <div class="layout-row range">
                                    <label>Range:</label>
                                    <input data-id="range" value="{{ $p.Range }}">
                                </div>
                            </div>
                            <div class="layout-row">
                                <div class="layout-row psychotest">
                                    <label>Psychotest:</label>
                                    <input data-id="psychotest" value="{{ $p.Psychotest }}">
                                </div>
                                <div class="layout-row action">
                                    <label for="action">Action:</label>
                                    <input data-id="action" value="{{ $p.Action }}">
                                </div>
                                <div class="layout-row sustained">
                                    <label>Sustained:</label>
                                    <input data-id="sustained" value="{{ $p.Sustained }}">
                                </div>
                            </div>
                            <div class="layout-row">
                                <div class="layout-row weapon-range">
                                    <label>Range:</label>
                                    <input data-id="weapon-range" value="{{ $p.WeaponRange }}">
                                </div>
                                <div class="layout-row damage">
                                    <label>Damage:</label>
                                    <input data-id="damage" value="{{ $p.Damage }}">
                                </div>
                                <div class="layout-row pen">
                                    <label>Pen:</label>
                                    <input data-id="pen" value="{{ $p.Pen }}">
                                </div>
                                <div class="layout-row type">
                                    <label>Type:</label>
                                    <select data-id="damage-type">
                                        <option value="I" {{if eq $p.DamageType "I" }}selected{{end}}>I</option>
                                        <option value="I(Cr)" {{if eq $p.DamageType "I(Cr)" }}selected{{end}}>I(Cr)
                                        </option>
                                        <option value="R" {{if eq $p.DamageType "R" }}selected{{end}}>R</option>
                                        <option value="X" {{if eq $p.DamageType "X" }}selected{{end}}>X</option>
                                        <option value="X(Fr)" {{if eq $p.DamageType "X(Fr)" }}selected{{end}}>X(Fr)
                                        </option>
                                        <option value="E" {{if eq $p.DamageType "E" }}selected{{end}}>E</option>
                                        <option value="E(El)" {{if eq $p.DamageType "E(El)" }}selected{{end}}>E(El)
                                        </option>
                                        <option value="E(Ls)" {{if eq $p.DamageType "E(Ls)" }}selected{{end}}>E(Ls)
                                        </option>
                                        <option value="E(Fl)" {{if eq $p.DamageType "E(Fl)" }}selected{{end}}>E(Fl)
                                        </option>
                                        <option value="C" {{if eq $p.DamageType "C" }}selected{{end}}>C</option>
                                        <option value="C(Tx)" {{if eq $p.DamageType "C(Tx)" }}selected{{end}}>C(Tx)
                                        </option>
                                    </select>
                                </div>
                            </div>
                            <div class="layout-row">
                                <div class="layout-row rof">
                                    <label>RoF:</label>
                                    <input data-id="rof-single" value="{{ $p.RoFSingle }}" />/
                                    <input class="shorter-input" data-id="rof-short" value="{{ $p.RoFShort }}" />/
                                    <input class="shorter-input" data-id="rof-long" value="{{ $p.RoFLong }}" />
                                </div>
                                <div class="layout-row special">
                                    <label>Special:</label>
                                    <input data-id="special" value="{{ $p.Special }}">
                                </div>
                            </div>
                            <textarea class="split-description" placeholder=" "
                                data-id="effect">{{ $p.Effect }}</textarea>
                        </div>
                    </div>
                    {{ end }}
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}
        {{ end }}
        <button class="add-tab-btn">+</button>
    </div>
</div>
{{end}}


{{define "psychotest_roll"}}
{{ $attackId := .key }}
{{ $roll := .p.Roll }}

<div class="roll-dropdown" data-id="roll">
    {{/* Select with characteristic or skill and test difficulty input */}}
   <div class="roll-column base">
        <label class="column-label">Psychotest</label>
        <div class="roll-column-content">
            <select data-id="base-select">
                <option value="W" data-type="characteristic" {{if eq $roll.BaseSelect "W" }}selected{{end}}>W</option>
                <option value="P" data-type="characteristic" {{if eq $roll.BaseSelect "P" }}selected{{end}}>P</option>
                <option value="Psyniscience" data-type="skill" {{if eq $roll.BaseSelect "Psyniscience"
                    }}selected{{end}}>Psyniscience</option>
                <option value="Logic" data-type="skill" {{if eq $roll.BaseSelect "Logic" }}selected{{end}}>Logic
                </option>
                <option value="Cor" data-type="characteristic" {{if eq $roll.BaseSelect "Cor" }}selected{{end}}>Cor
                </option>
            </select>
            <label class="modifier-label">Modifier:</label>
            <input type="number" data-id="modifier" value="{{$roll.Modifier}}">
        </div>
    </div>

    {{/* Effective PR */}}
    <div class="roll-column pr-column">
        <label class="column-label">Effective PR</label>
        <div class="roll-column-content">
            <input type="number" data-id="effective-pr" value="{{$roll.EffectivePR}}">
            <div class="pr-buttons">
                <button type="button" data-id="pr-zero" class="pr-button">0</button>
                <button type="button" data-id="pr-max" class="pr-button">Max</button>
            </div>
        </div>
    </div>

    {{/* Kick PR */}}
    <div class="roll-column pr-column">
        <label class="column-label">Kick</label>
        <div class="roll-column-content">
            <input type="number" data-id="kick-pr" value="{{$roll.KickPR}}">
            <div class="pr-buttons">
                <button type="button" data-id="kick-zero" class="pr-button">0</button>
                <button type="button" data-id="kick-max" class="pr-button">Max</button>
            </div>
        </div>
    </div>

    {{/* Extra Modifiers */}}
    <div data-id="extra1" class="extra-modifier">
        <input type="text" data-id="name" placeholder="Extra 1" value="{{$roll.Extra1.Name}}">
        <div class="roll-column-content">
            <input type="number" data-id="value" placeholder="0" value="{{$roll.Extra1.Value}}">
            <input type="checkbox" data-id="enabled" class="custom" {{if $roll.Extra1.Enabled}}checked{{end}}>
        </div>
    </div>

    <div data-id="extra2" class="extra-modifier">
        <input type="text" data-id="name" placeholder="Extra 2" value="{{$roll.Extra2.Name}}">
        <div class="roll-column-content">
            <input type="number" data-id="value" placeholder="0" value="{{$roll.Extra2.Value}}">
            <input type="checkbox" data-id="enabled" class="custom" {{if $roll.Extra2.Enabled}}checked{{end}}>
        </div>
    </div>

    {{/* Result */}}
    <div class="roll-result">
        <input type="number" data-id="total" class="uneditable textlike" readonly>
        <button data-id="roll-button">Roll</button>
    </div>
</div>
{{end}}