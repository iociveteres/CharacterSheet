{{define "melee_attacks"}}
<div id="melee-attack" data-id="melee-attack.items" class="item-grid">
    {{ $cols := layoutMeleeAttacks "melee-attack" .MeleeAttacks }}
    {{ range $colIndex, $col := $cols }}
    <div class="layout-column" data-column="{{ $colIndex }}">
        {{ range $rowIndex, $key := $col }}
        {{ $ma := index $.MeleeAttacks.Items $key }}
        <div class="melee-attack item-with-description {{ if $ma.Description }}{{ else }}collapsed{{ end }}"
            data-id="{{ $key }}">
            <div class="layout-row split-header dropdown-parent">
                <div class="layout-row name">
                    <label class="rollable">Name:</label>
                    <input class="long-input" data-id="name" value="{{ $ma.Name }}" />
                </div>
                <button class="toggle-button"></button>
                <div class="layout-row group">
                    <label>Group:</label>
                    <select data-id="group">
                        <option value="primary" {{if eq $ma.Group "primary" }}selected{{end}}>Primary</option>
                        <option value="chain" {{if eq $ma.Group "chain" }}selected{{end}}>Chain</option>
                        <option value="shock" {{if eq $ma.Group "shock" }}selected{{end}}>Shock</option>
                        <option value="power" {{if eq $ma.Group "power" }}selected{{end}}>Power</option>
                        <option value="exotic" {{if eq $ma.Group "exotic" }}selected{{end}}>Exotic</option>
                    </select>
                    <div class="drag-handle"></div>
                    <button class="delete-button"></button>
                </div>

                {{ if $ma.Roll }}
                {{template "melee_attack_roll" $ma}}
                {{ end }}
            </div>

            <div class="layout-row">
                <div class="layout-row grip">
                    <label>Grips:</label>
                    <input data-id="grip" value="{{ $ma.Grip }}" />
                </div>
                <div class="layout-row balance">
                    <label>Balance:</label>
                    <input data-id="balance" value="{{ $ma.Balance }}" />
                </div>
            </div>
            <div class="layout-row">
                <div class="layout-row upgrades">
                    <label>Upgrades:</label>
                    <input data-id="upgrades" value="{{ $ma.Upgrades }}" />
                </div>
            </div>
            <div class="tabs" data-id="tabs.items">
                {{ $tabCols := layoutMeleeTabs "tabs" $ma.Tabs }}
                {{ range $colIndex, $col := $tabCols }}
                {{ range $rowIndex, $tabKey := $col }}
                {{ $tab := index $ma.Tabs.Items $tabKey }}
                {{ $isFirst := and (eq $colIndex 0) (eq $rowIndex 0) }}
                <input class="radiotab" type="radio" id="{{ $tabKey }}" name="{{ $key }}" {{if
                    $isFirst}}checked{{end}} />
                <label class="tablabel" for="{{ $tabKey }}" data-id="{{ $tabKey }}">
                    <select data-id="profile">
                        <option value="mace" {{if eq $tab.Profile "mace" }}selected{{end}}>Mace</option>
                        <option value="glaive" {{if eq $tab.Profile "glaive" }}selected{{end}}>Glaive</option>
                        <option value="flail" {{if eq $tab.Profile "flail" }}selected{{end}}>Flail</option>
                        <option value="whip" {{if eq $tab.Profile "whip" }}selected{{end}}>Whip</option>
                        <option value="claws" {{if eq $tab.Profile "claws" }}selected{{end}}>Claws</option>
                        <option value="claws.h" {{if eq $tab.Profile "claws.h" }}selected{{end}}>Claws.H</option>
                        <option value="claws.a" {{if eq $tab.Profile "claws.a" }}selected{{end}}>Claws.A</option>
                        <option value="spear" {{if eq $tab.Profile "spear" }}selected{{end}}>Spear</option>
                        <option value="hook" {{if eq $tab.Profile "hook" }}selected{{end}}>Hook</option>
                        <option value="fist" {{if eq $tab.Profile "fist" }}selected{{end}}>Fist</option>
                        <option value="fist.a" {{if eq $tab.Profile "fist.a" }}selected{{end}}>Fist.A</option>
                        <option value="sword" {{if eq $tab.Profile "sword" }}selected{{end}}>Sword</option>
                        <option value="rapier" {{if eq $tab.Profile "rapier" }}selected{{end}}>Rapier</option>
                        <option value="saber" {{if eq $tab.Profile "saber" }}selected{{end}}>Saber</option>
                        <option value="hammer" {{if eq $tab.Profile "hammer" }}selected{{end}}>Hammer</option>
                        <option value="axe" {{if eq $tab.Profile "axe" }}selected{{end}}>Axe</option>
                        <option value="knife" {{if eq $tab.Profile "knife" }}selected{{end}}>Knife</option>
                        <option value="staff" {{if eq $tab.Profile "staff" }}selected{{end}}>Staff</option>
                        <option value="bayonet" {{if eq $tab.Profile "bayonet" }}selected{{end}}>Bayonet</option>
                        <option value="shield" {{if eq $tab.Profile "shield" }}selected{{end}}>Shield</option>
                        <option value="bite" {{if eq $tab.Profile "bite" }}selected{{end}}>Bite</option>
                        <option value="no" {{if eq $tab.Profile "no" }}selected{{end}}>No</option>
                    </select>
                    <div class="drag-handle"></div>
                    <button class="delete-button"></button>
                </label>
                <div data-id="{{ $tabKey }}" class="panel">
                    <div class="profile-tab">
                        <div class="layout-row">
                            <div class="layout-row range">
                                <label>Range:</label>
                                <input data-id="range" value="{{ $tab.Range }}" />
                            </div>
                            <div class="layout-row damage">
                                <label>Damage:</label>
                                <input data-id="damage" value="{{ $tab.Damage }}" />
                            </div>
                            <div class="layout-row pen">
                                <label>Pen:</label>
                                <input data-id="pen" value="{{ $tab.Pen }}" />
                            </div>
                            <div class="layout-row damage-type">
                                <label>Type:</label>
                                <select data-id="damage-type">
                                    <option value="I" {{if eq $tab.DamageType "I" }}selected{{end}}>I</option>
                                    <option value="I(Cr)" {{if eq $tab.DamageType "I(Cr)" }}selected{{end}}>I(Cr)
                                    </option>
                                    <option value="R" {{if eq $tab.DamageType "R" }}selected{{end}}>R</option>
                                    <option value="X" {{if eq $tab.DamageType "X" }}selected{{end}}>X</option>
                                    <option value="X(Fr)" {{if eq $tab.DamageType "X(Fr)" }}selected{{end}}>X(Fr)
                                    </option>
                                    <option value="E" {{if eq $tab.DamageType "E" }}selected{{end}}>E</option>
                                    <option value="E(El)" {{if eq $tab.DamageType "E(El)" }}selected{{end}}>E(El)
                                    </option>
                                    <option value="E(Ls)" {{if eq $tab.DamageType "E(Ls)" }}selected{{end}}>E(Ls)
                                    </option>
                                    <option value="E(Fl)" {{if eq $tab.DamageType "E(Fl)" }}selected{{end}}>E(Fl)
                                    </option>
                                    <option value="C" {{if eq $tab.DamageType "C" }}selected{{end}}>C</option>
                                    <option value="C(Tx)" {{if eq $tab.DamageType "C(Tx)" }}selected{{end}}>C(Tx)
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="layout-row">
                            <div class="layout-row special">
                                <label>Special:</label>
                                <input data-id="special" value="{{ $tab.Special }}" />
                            </div>
                        </div>
                    </div>
                </div>
                {{ end }}
                {{ end }}
                <button class="add-tab-btn">+</button>
            </div>
            <div class="collapsible-content">
                <textarea class="split-description" placeholder=" "
                    data-id="description">{{ $ma.Description }}</textarea>
            </div>
        </div> <!-- end melee-attack -->
        {{ end }}
    </div> <!-- end layout-column -->
    {{ end }}
</div>
{{end}}

{{define "melee_attack_roll"}}
{{ $attackId := .Name }}
{{ $roll := .Roll }}

<div class="attack-roll-dropdown melee" data-id="roll">
    {{/* Aim Column */}}
    <div data-id="aim" class="roll-column aim">
        <label class="column-label">Aim</label>
        <div class="roll-column-content">
            <div class="radio-option">
                <input type="radio" name="aim-{{$attackId}}" value="no" {{if eq $roll.Aim.Selected "no"
                    }}checked{{end}}>
                <label>No</label>
                <input type="number" data-id="no" value="{{$roll.Aim.No}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="aim-{{$attackId}}" value="half" {{if eq $roll.Aim.Selected "half"
                    }}checked{{end}}>
                <label>Half</label>
                <input type="number" data-id="half" value="{{$roll.Aim.Half}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="aim-{{$attackId}}" value="full" {{if eq $roll.Aim.Selected "full"
                    }}checked{{end}}>
                <label>Full</label>
                <input type="number" data-id="full" value="{{$roll.Aim.Full}}">
            </div>
        </div>
    </div>

    {{/* Target Column */}}
    <div data-id="target" class="roll-column target">
        <label class="column-label">Target</label>
        <div class="roll-column-content">
            <div class="radio-option">
                <input type="radio" name="target-{{$attackId}}" value="no" {{if eq $roll.Target.Selected "no"
                    }}checked{{end}}>
                <label>No</label>
                <input type="number" data-id="no" value="{{$roll.Target.No}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="target-{{$attackId}}" value="torso" {{if eq $roll.Target.Selected "torso"
                    }}checked{{end}}>
                <label>Torso</label>
                <input type="number" data-id="torso" value="{{$roll.Target.Torso}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="target-{{$attackId}}" value="leg" {{if eq $roll.Target.Selected "leg"
                    }}checked{{end}}>
                <label>Leg</label>
                <input type="number" data-id="leg" value="{{$roll.Target.Leg}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="target-{{$attackId}}" value="arm" {{if eq $roll.Target.Selected "arm"
                    }}checked{{end}}>
                <label>Arm</label>
                <input type="number" data-id="arm" value="{{$roll.Target.Arm}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="target-{{$attackId}}" value="head" {{if eq $roll.Target.Selected "head"
                    }}checked{{end}}>
                <label>Head</label>
                <input type="number" data-id="head" value="{{$roll.Target.Head}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="target-{{$attackId}}" value="joint" {{if eq $roll.Target.Selected "joint"
                    }}checked{{end}}>
                <label>Joint</label>
                <input type="number" data-id="joint" value="{{$roll.Target.Joint}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="target-{{$attackId}}" value="eyes" {{if eq $roll.Target.Selected "eyes"
                    }}checked{{end}}>
                <label>Eyes</label>
                <input type="number" data-id="eyes" value="{{$roll.Target.Eyes}}">
            </div>
        </div>
    </div>

    {{/* Base Column */}}
    <div data-id="base" class="roll-column base">
        <label class="column-label">Base</label>
        <div class="roll-column-content">
            <div class="radio-option">
                <input type="radio" name="base-{{$attackId}}" value="standard" {{if eq $roll.Base.Selected "standard"
                    }}checked{{end}}>
                <label>Standard</label>
                <input type="number" data-id="standard" value="{{$roll.Base.Standard}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="base-{{$attackId}}" value="charge" {{if eq $roll.Base.Selected "charge"
                    }}checked{{end}}>
                <label>Charge</label>
                <input type="number" data-id="charge" value="{{$roll.Base.Charge}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="base-{{$attackId}}" value="full" {{if eq $roll.Base.Selected "full"
                    }}checked{{end}}>
                <label>Full</label>
                <input type="number" data-id="full" value="{{$roll.Base.Full}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="base-{{$attackId}}" value="careful" {{if eq $roll.Base.Selected "careful"
                    }}checked{{end}}>
                <label>Careful</label>
                <input type="number" data-id="careful" value="{{$roll.Base.Careful}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="base-{{$attackId}}" value="mounted" {{if eq $roll.Base.Selected "mounted"
                    }}checked{{end}}>
                <label>Mounted</label>
                <input type="number" data-id="mounted" value="{{$roll.Base.Mounted}}">
            </div>
        </div>
    </div>

    {{/* Stance Column */}}
    <div data-id="stance" class="roll-column stance">
        <label class="column-label">Stance</label>
        <div class="roll-column-content">
            <div class="radio-option">
                <input type="radio" name="stance-{{$attackId}}" value="standard" {{if eq
                    $roll.Stance.Selected "standard" }}checked{{end}}>
                <label>Standard</label>
                <input type="number" data-id="standard" value="{{$roll.Stance.Standard}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="stance-{{$attackId}}" value="aggressive" {{if eq
                    $roll.Stance.Selected "aggressive" }}checked{{end}}>
                <label>Aggressive</label>
                <input type="number" data-id="aggressive" value="{{$roll.Stance.Aggressive}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="stance-{{$attackId}}" value="defensive" {{if eq
                    $roll.Stance.Selected "defensive" }}checked{{end}}>
                <label>Defensive</label>
                <input type="number" data-id="defensive" value="{{$roll.Stance.Defensive}}">
            </div>
        </div>
    </div>

    {{/* RoF Column */}}
    <div data-id="rof" class="roll-column rof">
        <label class="column-label">RoF</label>
        <div class="roll-column-content">
            <div class="radio-option">
                <input type="radio" name="rof-{{$attackId}}" value="single" {{if eq $roll.RoF.Selected "single"
                    }}checked{{end}}>
                <label>Single</label>
                <input type="number" data-id="single" value="{{$roll.RoF.Single}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="rof-{{$attackId}}" value="quick" {{if eq $roll.RoF.Selected "quick"
                    }}checked{{end}}>
                <label>Quick</label>
                <input type="number" data-id="quick" value="{{$roll.RoF.Quick}}">
            </div>
            <div class="radio-option">
                <input type="radio" name="rof-{{$attackId}}" value="lightning" {{if eq $roll.RoF.Selected "lightning"
                    }}checked{{end}}>
                <label>Lightning</label>
                <input type="number" data-id="lightning" value="{{$roll.RoF.Lightning}}">
            </div>
        </div>
    </div>

    {{/* Extra Modifiers */}}
    <div data-id="extra1" class="extra-modifier">
        <input type="text" data-id="name" placeholder="Extra 1" value="{{$roll.Extra1.Name}}">
        <div class="roll-column-content">
            <input type="number" data-id="value" placeholder="0" value="{{$roll.Extra1.Value}}">
            <input type="checkbox" data-id="enabled" {{if $roll.Extra1.Enabled}}checked{{end}}>
        </div>
    </div>

    <div data-id="extra2" class="extra-modifier">
        <input type="text" data-id="name" placeholder="Extra 2" value="{{$roll.Extra2.Name}}">
        <div class="roll-column-content">
            <input type="number" data-id="value" placeholder="0" value="{{$roll.Extra2.Value}}">
            <input type="checkbox" data-id="enabled" {{if $roll.Extra2.Enabled}}checked{{end}}>
        </div>
    </div>

    {{/* Result */}}
    <div class="roll-result">
        <input type="number" data-id="total" class="uneditable textlike" readonly>
        <button data-id="roll-button">Roll</button>
    </div>
</div>
{{end}}